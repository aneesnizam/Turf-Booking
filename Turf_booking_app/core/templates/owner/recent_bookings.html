{% extends 'core_base/base.html' %}
{% load static %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Page Header -->
  <div class="mb-8">
    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">Recent Bookings</h1>
        <p class="mt-2 text-sm text-gray-600">
          View all recent bookings across your turfs
        </p>
      </div>
      <div>
        <a href="{% url 'owner_dashboard' %}" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
          <i class="fas fa-arrow-left mr-2"></i> Back to Dashboard
        </a>
      </div>
    </div>
  </div>

  <!-- Filters -->
<form id="filter-form" class="mb-6 bg-white shadow rounded-lg p-4">
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
    <div>
      <label for="turf-filter" class="block text-sm font-medium text-gray-700 mb-1">Turf</label>
      <select id="turf-filter" name="turf" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md">
        <option value="">All Turfs</option>
        {% for turf in turfs %}
          <option value="{{ turf.id }}">{{ turf.turf_name }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label for="status-filter" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
      <select id="status-filter" name="status" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md">
        <option value="">All Statuses</option>
        <option value="confirmed">Confirmed</option>
        <option value="pending">Pending</option>
        <option value="cancelled">Cancelled</option>
      </select>
    </div>
    <div>
      <label for="booking-date" class="block text-sm font-medium text-gray-700 mb-1">Booking Date</label>
      <input type="date" id="booking-date" name="booking_date" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md">
    </div>
    <div>
      <label for="min-amount" class="block text-sm font-medium text-gray-700 mb-1">Min amount</label>
      <input type="number" id="min-amount" name="min_amount" placeholder="e.g. 500" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md">
    </div>
  </div>
  <div class="mt-4 flex justify-end">
    <button type="button" id="apply-filters-btn" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
      <i class="fas fa-filter mr-2"></i> Apply Filters
    </button>
  </div>
</form>
 <div id="booking-content-container">
    {% include 'partials/_booking_list_partial.html' %}
  </div>
</div>


<script>
// Get references to all the important elements on the page
const filterForm = document.getElementById('filter-form');
const applyFiltersBtn = document.getElementById('apply-filters-btn');
const contentContainer = document.getElementById('booking-content-container');


function fetchBookingContent(queryString = '') {
    const loaderHTML = `<div class="w-full text-center p-8"><p class="text-gray-500 font-medium">Loading...</p></div>`;
    contentContainer.innerHTML = loaderHTML;

    // The actual fetch request
    fetch(`?${queryString}`, {
        headers: { "x-requested-with": "XMLHttpRequest" }
    })
    .then(response => response.text())
    .then(html => {
        contentContainer.innerHTML = html;
    })
    .catch(err => {
        console.error("Failed to fetch content:", err);
        contentContainer.innerHTML = `<p class="text-center text-red-500 p-4">Error loading content.</p>`;
    });
}


function getFilterParams() {
  
    const formData = new FormData(filterForm);
    const params = new URLSearchParams(formData);
    return params;
}

applyFiltersBtn.addEventListener('click', () => {
    const params = getFilterParams();
    params.set('pagination_page', '1');
    fetchBookingContent(params.toString());
});


contentContainer.addEventListener('click', (e) => {
    const pageLink = e.target.closest('[data-pages]');
    if (pageLink) {
        e.preventDefault();
        const page = pageLink.getAttribute('data-pages');
        const params = getFilterParams(); 
        params.set('pagination_page', page); 
        
        fetchBookingContent(params.toString());
    }
});
</script>

{% endblock %}